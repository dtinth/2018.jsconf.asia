Node.js Master:
  image: node:latest
  cache:
    key: node-master
    paths:
      - node_modules
      - nodejs-source
  script:
    # Set up Linux key management for localhost cert generation
    - apt-get update
    - apt-get install libnss3-tools --assume-yes

    # Build nodejs/node#master from source
    - '[[ -d nodejs-source ]] || git clone https://github.com/nodejs/node.git nodejs-source'
    - cd nodejs-source
    - git checkout master
    - git fetch
    - git reset --hard origin/master
    - git status
    - ./configure
    - make -j4
    - make install
    - cd ..

    - node -v
    - npm version

    - NPM_CONFIG_LOGLEVEL=warn
    - npm i --nodedir=$(pwd)/nodejs-source

    - npm t

Node.js Current:
  image: node:latest
  cache:
    key: node-current
    paths:
      - node_modules
  script:
    # Set up Linux key management for localhost cert generation
    - apt-get update
    - apt-get install libnss3-tools --assume-yes

    - node -v
    - npm version

    - NPM_CONFIG_LOGLEVEL=warn
    - npm it
